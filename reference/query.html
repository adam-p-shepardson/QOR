<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Geocode Unit (Voter) Addresses to Longitude/Latitude Coordinates — query • QOR</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/Google_Sans_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Geocode Unit (Voter) Addresses to Longitude/Latitude Coordinates — query"><meta name="description" content='The query() function performs the "Query" (Step 1) operation from the QOR Method.'><meta property="og:description" content='The query() function performs the "Query" (Step 1) operation from the QOR Method.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">QOR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/data-setup.html">Data Setup</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Getting Started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/state-fips.html">State FIPS Codes</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/extra-notes.html">Extra Notes</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adam-p-shepardson/QOR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Geocode Unit (Voter) Addresses to Longitude/Latitude Coordinates</h1>
      <small class="dont-index">Source: <a href="https://github.com/adam-p-shepardson/QOR/blob/main/R/Query.r" class="external-link"><code>R/Query.r</code></a></small>
      <div class="d-none name"><code>query.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>query()</code> function performs the "Query" (Step 1) operation from the QOR Method.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">query</span><span class="op">(</span></span>
<span>  units <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  unit_id <span class="op">=</span> <span class="st">"unit_id"</span>,</span>
<span>  street <span class="op">=</span> <span class="st">"street"</span>,</span>
<span>  city <span class="op">=</span> <span class="st">"city"</span>,</span>
<span>  state <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  state_shape <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  units_per_batch <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>  year <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"census"</span>,</span>
<span>  sleep_time <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  unit_zip <span class="op">=</span> <span class="st">"postalcode"</span>,</span>
<span>  max_tries <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-units">units<a class="anchor" aria-label="anchor" href="#arg-units"></a></dt>
<dd><p>Dataframe or tibble containing voter information (must have unique unit_id, street, city, and state columns).</p></dd>


<dt id="arg-unit-id">unit_id<a class="anchor" aria-label="anchor" href="#arg-unit-id"></a></dt>
<dd><p>Name of the column in the units dataframe that contains the unique identifiers for each unit (default: "unit_id"). Preferably as string.</p></dd>


<dt id="arg-street">street<a class="anchor" aria-label="anchor" href="#arg-street"></a></dt>
<dd><p>Name of the column in the units dataframe that contains the street address (default: "street").</p></dd>


<dt id="arg-city">city<a class="anchor" aria-label="anchor" href="#arg-city"></a></dt>
<dd><p>Name of the column in the units dataframe that contains the city (default: "city").</p></dd>


<dt id="arg-state">state<a class="anchor" aria-label="anchor" href="#arg-state"></a></dt>
<dd><p>Name of the column in the units dataframe that contains the state (default: "state").</p></dd>


<dt id="arg-state-shape">state_shape<a class="anchor" aria-label="anchor" href="#arg-state-shape"></a></dt>
<dd><p>sf object containing the shape of the state (used to filter geocoding results to the state, catching errors).</p></dd>


<dt id="arg-units-per-batch">units_per_batch<a class="anchor" aria-label="anchor" href="#arg-units-per-batch"></a></dt>
<dd><p>Number of units to geocode in each batch (default: 4000). Internet connectivity and API limits determine possibility of larger (or smaller) batches. The Census theoretically allows batches of up to 10,000 addresses, but we have found that smaller batches are less likely to be rejected by the API.</p></dd>


<dt id="arg-year">year<a class="anchor" aria-label="anchor" href="#arg-year"></a></dt>
<dd><p>Year of the data (preferably numeric) for use with "census" method. (default: NULL, which throws an error). Program was designed for years 2007 through 2025 using the "census" method. Years &lt;= 2010 will use the 2010 Census database, and years &gt; 2025 will use the current Census database.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Geocoding method to use (default: "census"). See methods from <code><a href="https://jessecambon.github.io/tidygeocoder/reference/geocode.html" class="external-link">tidygeocoder::geocode()</a></code>. We recommend "census" for best cost (free) and batch geocoding. You may need to adjust parts of code that select outputs if using different method, and not all methods may support the batch coding that we use by default.</p></dd>


<dt id="arg-sleep-time">sleep_time<a class="anchor" aria-label="anchor" href="#arg-sleep-time"></a></dt>
<dd><p>Time to pause between batches (default: 2 seconds). Try increasing if you are getting rate-limited by the geocoding service or encountering connection issues.</p></dd>


<dt id="arg-unit-zip">unit_zip<a class="anchor" aria-label="anchor" href="#arg-unit-zip"></a></dt>
<dd><p>RECOMMENDED BUT OPTIONAL name of the column in the units dataframe that contains the postal code (default: "postalcode"). Preferably as string. Output will have a postalcode column if provided, but this column will be NA if not provided. "Recover" will NOT be able to match any unmatched units if postalcode not provided here.</p></dd>


<dt id="arg-max-tries">max_tries<a class="anchor" aria-label="anchor" href="#arg-max-tries"></a></dt>
<dd><p>Number of times to attempt geocoding for each unit if a call to API fails (default: 15). Try increasing if you are getting rate-limited by the geocoding service or encountering connection issues. If a unit fails to geocode after this many attempts, it will be stored as unmatched and the function will move on to the next unit.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with two items: (1) Tibble of matched units with their geocoded coordinates, and (2) Tibble of unmatched units (those that could not be geocoded).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function:</p><ul><li><p>Assigns longitude and latitude coordinates to units (e.g., voters) based on their street address, city, and state.</p></li>
<li><p>Acts as a wrapper around <code><a href="https://jessecambon.github.io/tidygeocoder/reference/geocode.html" class="external-link">tidygeocoder::geocode()</a></code>, while also handling additional processing needed for individual voter data and preparing for subsequent QOR Method steps.</p></li>
<li><p><strong>Note:</strong> This function does not perform matching to polygons below the state-level or to zip codes; it simply geocodes the addresses.</p></li>
<li><p>Focuses on the Census geocoding service accessible through the <code>tidygeocoder</code> package (we recommend using the "census" method for best results). You will need to modify the code to use different geocoding services.</p></li>
</ul></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adam Shepardson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

